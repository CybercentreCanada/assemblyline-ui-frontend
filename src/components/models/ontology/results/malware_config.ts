import type { LookupType, RequestMethod } from 'components/models/ontology/results/network';

/** Based on model in MaCo framework */
export const CATEGORIES = [
  'adware',
  'apt',
  'backdoor',
  'banker',
  'bootkit',
  'bot',
  'browser_hijacker',
  'bruteforcer',
  'clickfraud',
  'cryptominer',
  'ddos',
  'downloader',
  'dropper',
  'exploitkit',
  'fakeav',
  'hacktool',
  'infostealer',
  'keylogger',
  'loader',
  'obfuscator',
  'pos',
  'proxy',
  'rat',
  'ransomware',
  'reverse_proxy',
  'rootkit',
  'scanner',
  'scareware',
  'spammer',
  'trojan',
  'virus',
  'wiper',
  'webshell',
  'worm'
] as const;
export type Category = (typeof CATEGORIES)[number];

export const CONNECTION_USAGE = [
  'c2',
  'upload',
  'download',
  'propagate',
  'tunnel',
  'other',
  'ransom',
  'decoy'
] as const;
export type ConnectionUsage = (typeof CONNECTION_USAGE)[number];

/**
 * Encryption details
 */
export const ENCRYPTION_USAGE = ['config', 'communication', 'binary', 'ransom', 'other'] as const;
export type EncryptionUsage = (typeof ENCRYPTION_USAGE)[number];

/** Encryption details */
export type Encryption = {
  /** Algorithm */
  algorithm?: string;

  /** Public Key */
  public_key?: string;

  /** Key */
  key?: string;

  /** Provider */
  provider?: string;

  /** Mode */
  mode?: string;

  /** Initialization Vector */
  iv?: string;

  /** Seed */
  seed?: string;

  /** Nonce value */
  nonce?: string;

  /** Constants */
  constants?: string[];

  /**
   * Purpose of encryptions
   */
  usage?: EncryptionUsage;
};

/** Binary data extracted by decoder */
export type Binary = {
  /** Data type: payload, config, or other */
  datatype?: 'payload' | 'config' | 'other';

  /** Data */
  data: string;

  /** Other information */
  other?: Record<string, unknown>;

  /** Encryption details */
  encryption?: Encryption[];
};

/** Usage of FTP connection */
export type FTP = {
  /** Username */
  username?: string;

  /** Password */
  password?: string;

  /** FTP Host */
  hostname?: string;

  /** FTP Port */
  port?: number;

  /** FTP Path */
  path?: string;

  /** Purpose of FTP connection */
  usage?: ConnectionUsage;
};

/** Usage of SMTP connection */
export type SMTP = {
  /** Username */
  username?: string;

  /** Password */
  password?: string;

  /** SMTP Host */
  hostname?: string;

  /** SMTP Port */
  port?: number;

  /** Sent to */
  mail_to?: string[];

  /** Sent from */
  mail_from?: string;

  /** Subject */
  subject?: string;

  /** Purpose of SMTP connection */
  usage?: ConnectionUsage;
};

/** Usage of HTTP connection */
export type HTTP = {
  /** URI */
  uri?: string;

  /** Protocol */
  protocol?: 'http' | 'https';

  /** Username */
  username?: string;

  /** Password */
  password?: string;

  /** HTTP server */
  hostname?: string;

  /** HTTP Port */
  port?: number;

  /** URI Path */
  path?: string;

  /** Query parameters */
  query?: string;

  /** Fragment */
  fragment?: string;

  /** User Agent */
  user_agent?: string;

  /** Method */
  method?: RequestMethod;

  /** HTTP Headers */
  headers?: Record<string, string>;

  /** Maximum size */
  max_size?: number;

  /** Purpose of HTTP connection */
  usage?: ConnectionUsage;
};

/** Usage of SSH connection */
export type SSH = {
  /** Username */
  username?: string;

  /** Password */
  password?: string;

  /** SSH Public Key */
  public_key?: string;

  /** SSH Host */
  hostname?: string;

  /** SSH Port */
  port?: number;

  /** Purpose of SSH connection */
  usage?: ConnectionUsage;
};

/** Usage of Proxy connection */
export type Proxy = {
  /** Username */
  username?: string;

  /** Password */
  password?: string;

  /** Proxy Host */
  hostname?: string;

  /** Proxy Port */
  port?: number;

  /** Purpose of proxy connection */
  usage?: ConnectionUsage;

  /** Protocol used */
  protocol?: string;
};

/** Usage of DNS connection */
export type DNS = {
  /** IP of DNS server */
  ip?: string;

  /** Port of DNS server */
  port?: number;

  /** Hostname used in query */
  hostname?: string;

  /** Type of DNS record */
  record_type?: LookupType;

  /** Purpose of DNS connection */
  usage?: ConnectionUsage;
};

/** Usage of General TCP/UDP connection */
export type GeneralConnection = {
  /** Client IP */
  client_ip?: string;

  /** Client Port */
  client_port?: number;

  /** Server IP */
  server_ip?: string;

  /** Server Domain */
  server_domain?: string;

  /** Server Port */
  server_port?: number;

  /** Purpose of TCP/UDP connection */
  usage?: ConnectionUsage;
};

/** Operating System services affected */
export type Service = {
  /** DLL associated to service */
  dll?: string;

  /** Name of service */
  name?: string;

  /** Display Name of service */
  display_name?: string;

  /** Service Description */
  description?: string;
};

/** Cryptocoin usage (ransomware/miner) */
export type Cryptocurrency = {
  /** Name of coin used */
  coin?: string;

  /** Wallet address */
  address?: string;

  /** Ransom amount */
  random_amount?: number;

  /** Use of cryptocurrency */
  usage?: 'ransomware' | 'miner' | 'other';
};

/** File Paths */
export type Path = {
  /** Path */
  path?: string;

  /** Use of path */
  usage?: 'c2' | 'config' | 'install' | 'plugins' | 'logs' | 'storage' | 'other';
};

/** Inter-Process Communications */
export type IPC = {
  /**
   * A record stored on disk, or a record synthesized on demand by a file server,
   * which can be accessed by multiple processes.
   */
  file?: string[];

  /**
   * Data sent over a network interface, either to a different process on the same
   * computer or to another computer on the network. Stream oriented (TCP; data written
   * through a socket requires formatting to preserve message boundaries) or more rarely
   * message-oriented (UDP, SCTP).
   */
  socket?: string[];

  /**
   * Similar to an internet socket, but all communication occurs within the kernel.
   * Domain sockets use the file system as their address space.
   */
  unix_domain_socket?: string[];

  /**
   * A file mapped to RAM and can be modified by changing memory addresses directly
   * instead of outputting to a stream. This shares the same benefits as a standard file.
   */
  memory_mapped_file?: string[];

  /**
   * A data stream similar to a socket, but which usually preserves message boundaries.
   * Typically implemented by the operating system, they allow multiple processes to read
   * and write to the message queue without being directly connected to each other.
   */
  message_queue?: string[];

  /**
   * A unidirectional data channel using standard input and output.
   * Two-way communication can be achieved by using two pipes in opposite directions.
   */
  anonymous_pipe?: string[];

  /**
   * A pipe that is treated like a file. Instead of using standard input/output as with
   * an anonymous pipe, processes write to and read from a named pipe as if it were a regular file.
   */
  named_pipe?: string[];

  /** The process names involved in the IPC communication */
  process_names?: string[];

  /**
   * Multiple processes are given access to the same block of memory, creating a shared
   * buffer for communication.
   */
  shared_memory?: string;

  /** Purpose of connection */
  usage?: ConnectionUsage;
};

/** Registry */
export type Registry = {
  /** Registry key */
  key: string;

  /** Registry */
  value?: string;

  /** Use of registry key */
  usage?: 'persistence' | 'store_data' | 'store_payload' | 'read' | 'other';
};

/** Extracted Malware Configuration */
export type MalwareConfig = {
  /** Name of extractor */
  config_extractor: string;

  /** What family is this associated to? */
  family: string[];

  /** Version of the malware */
  version?: string;

  /** Category of malware */
  category?: Category[];

  /** ATT&CK ID associated */
  attack?: string[];

  /** Enabled Capabilities */
  capability_enabled?: string[];

  /** Disabled Capabilities */
  capability_disabled?: string[];

  /** Campaign ID */
  campaign_id?: string[];

  /** Identifier */
  identifier?: string[];

  /** Decoded Strings */
  decoded_strings?: string[];

  /** Passwords */
  password?: string[];

  /** Mutex */
  mutex?: string[];

  /** Pipe */
  pipe?: string[];

  /** IPC (similar to 'pipe' field but more detailed) */
  ipc?: IPC[];

  /** Sleep Delay */
  sleep_delay?: number;

  /** Sleep Delay Jitter */
  sleep_delay_jitter?: number;

  /** Injected EXE */
  inject_exe?: string[];

  /** Binaries */
  binaries?: Binary[];

  /** FTPs */
  ftp?: FTP[];

  /** SMTPs */
  smtp?: SMTP[];

  /** HTTPs */
  http?: HTTP[];

  /** SSHs */
  ssh?: SSH[];

  /** Proxies */
  proxy?: Proxy[];

  /** DNS */
  dns?: DNS[];

  /** TCPs */
  tcp?: GeneralConnection[];

  /** UDPs */
  udp?: GeneralConnection[];

  /** Encryptions */
  encryption?: Encryption[];

  /** Services */
  service?: Service[];

  /** Cryptocurrencies */
  cryptocurrency?: Cryptocurrency[];

  /** Paths */
  paths?: Path[];

  /** Registry */
  registry?: Registry[];

  /** Other information */
  other?: Record<string, unknown>;
};
